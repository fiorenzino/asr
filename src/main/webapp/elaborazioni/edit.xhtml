<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:perm="http://www.coopservice.it/commons2/permissions"
	xmlns:coop="http://www.coopservice.it/commons2/taglib"
	template="/WEB-INF/layout/t.xhtml">

	<ui:define name="title">Creazione Questionario</ui:define>

	<ui:define name="roles">
		<f:attribute name="roles" value="CREATE_QUESTIONARI" />
	</ui:define>

	<ui:define name="content">

		<ui:fragment rendered="#{empty questionariController.element.id}">
			<ui:include src="../clienti/dialog-fragment.xhtml">
				<ui:param name="toUpdate"
					value=":mainForm:denominazione :mainForm:denominazioneLabel" />
				<ui:param name="selectController" value="#{questionariController}" />
				<ui:param name="selectMethod" value="impostaCliente" />
			</ui:include>

			<ui:include src="../modelli/dialog-fragment.xhtml">
				<ui:param name="toUpdate"
					value=" :mainForm:categoria :mainForm:titolo :mainForm:categoriaLabel :mainForm:titoloLabel :mainForm:domande :mainForm:buttonGrid" />
				<ui:param name="selectController" value="#{questionariController}" />
				<ui:param name="selectMethod" value="impostaModello" />
			</ui:include>
		</ui:fragment>

		<h:form id="mainForm">

			<p:panel header="Informazioni generali">

				<h:panelGrid columns="1">

					<p:commandButton update=":clientiForm" value="Imposta cliente"
						onclick="clientiDialog.show();" />

					<h:panelGrid columns="2">
						<h:panelGroup id="denominazioneLabel">
							<h:outputLabel value="Cliente:" for="denominazione"
								rendered="#{not empty questionariController.element.cliente.id}" />
						</h:panelGroup>
						<h:panelGroup id="denominazione">
							<h:outputText
								rendered="#{not empty questionariController.element.cliente.id}"
								value="#{questionariController.element.cliente.denominazione}" />
						</h:panelGroup>
					</h:panelGrid>

					<p:commandButton update=":modelliForm" value="Imposta modello"
						onclick="modelliDialog.show();" />

					<h:panelGrid columns="2">
						<h:panelGroup id="categoriaLabel">
							<h:outputLabel value="Categoria:" for="categoria"
								rendered="#{not empty questionariController.element.categoria.id}" />
						</h:panelGroup>
						<h:panelGroup id="categoria">
							<h:outputText
								rendered="#{not empty questionariController.element.categoria.id}"
								value="#{questionariController.element.categoria.nome}" />
						</h:panelGroup>

						<h:panelGroup id="titoloLabel">
							<h:outputLabel value="Titolo:" for="titolo"
								rendered="#{not empty questionariController.element.titolo}" />
						</h:panelGroup>
						<h:panelGroup id="titolo">
							<h:outputText value="#{questionariController.element.titolo}"
								rendered="#{not empty questionariController.element.titolo}" />
						</h:panelGroup>
					</h:panelGrid>

				</h:panelGrid>
			</p:panel>

			<br />
			<br />

			<p:panel header="Note">
			<p:inputTextarea value="#{questionariController.element.note}" maxlength="2048" style="width: 95%;"/>
			</p:panel>

			<h:panelGroup id="domande">
				<ui:include src="../domande-pesate/list-fragment.xhtml">
					<ui:param name="model"
						value="#{questionariController.element.domandePesate}" />
					<ui:param name="suffix" value="DP" />
					<ui:param name="editable" value="false" />
				</ui:include>
			</h:panelGroup>

			<br />

			<h:panelGrid columns="3" id="buttonGrid">

				<p:commandButton action="#{questionariController.save}"
					value="Salva"
					rendered="#{empty questionariController.element.id and not empty questionariController.element.categoria.id and not empty questionariController.element.cliente.id}"
					ajax="false" />

				<p:commandButton action="#{questionariController.delete}"
					value="Elimina"
					onclick="if ( ! confirm('Confermi l\'eliminazione?') ) return false;"
					rendered="#{not empty questionariController.element.id}"
					ajax="false" />

				<p:commandButton action="#{questionariController.reset}"
					value="Annulla" ajax="false" immediate="true" />
			</h:panelGrid>

		</h:form>

	</ui:define>
</ui:composition>
